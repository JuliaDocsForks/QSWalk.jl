@testset "evolution" begin
    @testset "Exponent function" begin
    @test evolve_operator(zeros(4, 4), 1.) ≈ eye(4)

    # type check
    @test_throws MethodError evolve_operator(spzeros(4, 4), 1.)
  end

  @testset "Evolution functions" begin
    #size 4x4
    A = Complex{Float64}[0.354177+0.0im 0.0891553-0.0251879im 0.0702961+0.0516828im 0.0708664+0.0767941im;
                        0.0891553+0.0251879im 0.336055+0.0im 0.0420202-0.0109173im 0.0683605-0.00692846im;
                        0.0702961-0.0516828im 0.0420202+0.0109173im 0.212401+0.0im 0.0939615+0.0553555im;
                        0.0708664-0.0767941im 0.0683605+0.00692846im 0.0939615-0.0553555im 0.0973671+0.0im]
    S = [-131.0+0.0im -73.0+0.0im 16.0+3.0im -93.0+0.0im -73.0+0.0im 4.0+0.0im 6.0+0.0im 8.0+0.0im 16.0-3.0im 6.0+0.0im 10.0+0.0im 17.0+0.0im -93.0+0.0im 8.0+0.0im 17.0+0.0im 41.0+0.0im;
     -72.0+0.0im -148.0-0.8im 16.0+2.0im -104.0+3.0im 10.0+0.0im -63.0+0.0im 14.0+0.0im 16.0+0.0im 15.0+0.0im 31.0-3.0im 21.0+0.0im 32.0+0.0im 20.0+0.0im -73.0+0.0im 28.0+0.0im 72.0+0.0im;
     22.0+3.0im 21.0+2.0im -192.0+41.0im 14.0+0.0im 18.0+0.0im 20.0+0.0im -97.0+0.0im 24.0+0.0im 27.0+0.0im 30.0+0.0im -20.0-3.0im 36.0+0.0im 36.0+0.0im 40.0+0.0im -141.0+0.0im 48.0+0.0im;
      -95.0+0.0im -112.0+3.0im -3.0+0.0im -262.0+2.14159im 0.0+0.0im 0.0+0.0im 2.0+0.0im -65.0+0.0im 5.0+0.0im 6.0+0.0im 10.0+0.0im 36.0-3.0im 25.0+0.0im 30.0+0.0im 39.0+0.0im -37.0+0.0im;
       -72.0+0.0im 10.0+0.0im 15.0+0.0im 20.0+0.0im -148.0+0.8im -63.0+0.0im 31.0+3.0im -73.0+0.0im 16.0-2.0im 14.0+0.0im 21.0+0.0im 28.0+0.0im -104.0-3.0im 16.0+0.0im 32.0+0.0im 72.0+0.0im;
        25.0+0.0im -47.0+0.0im 35.0+0.0im 40.0+0.0im -47.0+0.0im -140.0+0.0im 51.0+2.0im -64.0+3.0im 35.0+0.0im 51.0-2.0im 49.0+0.0im 56.0+0.0im 40.0+0.0im -64.0-3.0im 56.0+0.0im 128.0+0.0im;
         45.0+0.0im 50.0+0.0im -132.0+0.0im 60.0+0.0im 67.0+3.0im 71.0+2.0im -269.0+41.8im 74.0+0.0im 63.0+0.0im 70.0+0.0im -68.0-2.0im 84.0+0.0im 72.0+0.0im 80.0+0.0im -200.0-3.0im 96.0+0.0im;
         0.0+0.0im 0.0+0.0im 5.0+0.0im -52.0+0.0im -95.0+0.0im -112.0+3.0im 2.0+0.0im -259.0+2.94159im 0.0+0.0im 0.0+0.0im 7.0+0.0im 44.0-2.0im 40.0+0.0im 48.0+0.0im 64.0+0.0im -8.0-3.0im;
         22.0-3.0im 18.0+0.0im 27.0+0.0im 36.0+0.0im 21.0-2.0im 20.0+0.0im 30.0+0.0im 40.0+0.0im -192.0-41.0im -97.0+0.0im -20.0+3.0im -141.0+0.0im 14.0+0.0im 24.0+0.0im 36.0+0.0im 48.0+0.0im;
          45.0+0.0im 67.0-3.0im 63.0+0.0im 72.0+0.0im 50.0+0.0im 71.0-2.0im 70.0+0.0im 80.0+0.0im -132.0+0.0im -269.0-41.8im -68.0+2.0im -200.0+3.0im 60.0+0.0im 74.0+0.0im 84.0+0.0im 96.0+0.0im;
           81.0+0.0im 90.0+0.0im -86.0-3.0im 108.0+0.0im 90.0+0.0im 100.0+0.0im -99.0-2.0im 120.0+0.0im -86.0+3.0im -99.0+2.0im -109.0+0.0im -130.0+0.0im 108.0+0.0im 120.0+0.0im -130.0+0.0im 144.0+0.0im;
           0.0+0.0im 0.0+0.0im 9.0+0.0im 58.0-3.0im 0.0+0.0im 0.0+0.0im 10.0+0.0im 61.0-2.0im -95.0+0.0im -112.0+3.0im -15.0+0.0im -371.0-38.8584im 0.0+0.0im 0.0+0.0im 12.0+0.0im 62.0+0.0im;
            -95.0+0.0im 0.0+0.0im 5.0+0.0im 25.0+0.0im -112.0-3.0im 0.0+0.0im 6.0+0.0im 30.0+0.0im -3.0+0.0im 2.0+0.0im 10.0+0.0im 39.0+0.0im -262.0-2.14159im -65.0+0.0im 36.0+3.0im -37.0+0.0im;
            0.0+0.0im -95.0+0.0im 0.0+0.0im 40.0+0.0im 0.0+0.0im -112.0-3.0im 0.0+0.0im 48.0+0.0im 5.0+0.0im 2.0+0.0im 7.0+0.0im 64.0+0.0im -52.0+0.0im -259.0-2.94159im 44.0+2.0im -8.0+3.0im;
            0.0+0.0im 0.0+0.0im -95.0+0.0im 0.0+0.0im 0.0+0.0im 0.0+0.0im -112.0-3.0im 0.0+0.0im 9.0+0.0im 10.0+0.0im -15.0+0.0im 12.0+0.0im 58.0+3.0im 61.0+2.0im -371.0+38.8584im 62.0+0.0im;
            25.0+0.0im 30.0+0.0im 35.0+0.0im -55.0+0.0im 30.0+0.0im 36.0+0.0im 42.0+0.0im -64.0-3.0im 35.0+0.0im 42.0+0.0im 50.0+0.0im 57.0+0.0im -55.0+0.0im -64.0+3.0im 57.0+0.0im -313.0+0.0im]
    state = zeros(4,4)
    state[3,3] = 1
    #trivial evolutions
    @test evolve(zeros(16, 16), A, 0.) ≈ A
    @test evolve(zeros(16, 16), sparse(A), 0.) ≈ A
    @test evolve(zeros(16, 16), A, [0., 5., 10.]) == [A, A, A]

    @test evolve(S, A, 0.) ≈ A
    @test evolve(eye(16), A) ≈ A
    @test trace(evolve(S, A, 1.))  ≈ trace(A)

    @test evolve(spzeros(16, 16), A, 0.) ≈ A
    @test evolve(spzeros(16, 16), A, [0., 5., 10.])[1] ≈ A
    @test evolve(spzeros(16, 16), A, [0., 5., 10.])[2] ≈ A
    @test evolve(spzeros(16, 16), A, [0., 5., 10.])[3] ≈ A

    @test evolve(sparse(rand(16, 16)), A, 0.) ≈ A
  end
end
